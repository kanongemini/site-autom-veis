!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},r=Error().stack;r&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[r]="6d5a1aaf-9d6c-4f40-9de4-7b6c78ef9c87",e._sentryDebugIdIdentifier="sentry-dbid-6d5a1aaf-9d6c-4f40-9de4-7b6c78ef9c87")}catch(e){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"2bd504c3"};"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9802],{23855:function(e,r,n){n.d(r,{sI:function(){return u}});var t=n(21262);function o(){var e=(0,t._)(["\n  fragment ReplViewerOutputOverlayRepl on Repl {\n    id\n    title\n    imageUrl\n    lastPublishedAt\n    currentUserPermissions {\n      changeImageUrl\n    }\n  }\n"]);return o=function(){return e},e}function i(){var e=(0,t._)(["\n  mutation ReplViewerOutputOverlayUpdateRepl($input: UpdateReplInput!) {\n    updateRepl(input: $input) {\n      repl {\n        id\n        imageUrl\n      }\n    }\n  }\n"]);return i=function(){return e},e}var u=(0,n(71440).Ps)(o());i()},30173:function(e,r,n){n.d(r,{S:function(){return u}});var t=n(7444),o=n(91087),i=n(50959);function u(){var e=(0,o.mC)(),r=(0,t.Z)(e);return(0,i.useCallback)(function(){var e,n;return!Number.isFinite(n=parseInt(null==(e=r.current)?void 0:e.variation("flag-container-retry-minimum-ms",0),10))||n<0?0:n},[r])}},33829:function(e,r,n){n.d(r,{Z:function(){return C}});var t={};n.r(t),n.d(t,{checkAndTrack:function(){return b},ensureTrackedFile:function(){return y},storeOp:function(){return m}});var o=n(59868),i=n(27387),u=n(66626),s=n(96583),l=n(11516),a=n(41733),c={};function f(e,r,n){var t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e.info("ot client dataloss",(0,a._)({case:r,startTime:n.startTime,opsSinceFlush:n.opsSinceFlush,whileReconnecting:n.whileReconnecting,replid:n.replId,filePath:n.filePath},t))}var p=n(70090),d={replsList:function(){return"dataLossRepls"},replFiles:function(e){return"dataLossReplFiles".concat(e)},latestOp:function(e,r){return"dataLossLatestOp--".concat(e,"--").concat(r)},latestFlushedOp:function(e,r){return"dataLossLatestFlushed--".concat(e,"--").concat(r)},latestOwnOp:function(e,r){return"dataLosslatestOwnOp--".concat(e,"--").concat(r)},opsSinceFlush:function(e,r){return"dataLossOpsSinceFlush--".concat(e,"--").concat(r)}};function h(){var e=l.Z.get(d.replsList(),"array");return e||(e=[],l.Z.set(d.replsList(),e)),e}function v(e){var r=l.Z.get(d.replFiles(e),"array");return r||(r=[],l.Z.set(d.replFiles(e),r)),r}function g(e){var r=v(e),n=!0,t=!1,o=void 0;try{for(var i,u=r[Symbol.iterator]();!(n=(i=u.next()).done);n=!0){var s=i.value;"string"==typeof s&&function(e,r){l.Z.remove(d.latestOp(e,r)),l.Z.remove(d.latestFlushedOp(e,r)),l.Z.remove(d.latestOwnOp(e,r));var n=v(e).filter(function(e){return e!==r});l.Z.set(d.replFiles(e),n)}(e,s)}}catch(e){t=!0,o=e}finally{try{n||null==u.return||u.return()}finally{if(t)throw o}}l.Z.remove(d.replFiles(e));var a=h().filter(function(r){return r!==e});l.Z.set(d.replsList(),a)}function y(e){var r,n=e.replId,t=e.filePath;(r=h()).includes(n)||(r.length>20?(g(r[0]),r[0]=n):r.push(n),l.Z.set(d.replsList(),r));var o=v(n);o.includes(t)||(o.length>20?(g(o[0]),o[0]=t):o.push(t),l.Z.set(d.replFiles(n),o))}function m(e){var r=e.filePath,n=e.replId,t=e.opType,o=e.op;!function(e){var r=e.filePath,n=e.replId,t=e.opType,o=e.logger,i=e.isReconnecting,u=f.bind(null,o),s="".concat(n,"--").concat(r);c[s]||(c[s]={replId:n,filePath:r,timer:null,startTime:null,whileReconnecting:0,opsSinceFlush:0});var l=c[s];if("latestFlushedOp"===t){delete c[s];var a=l.startTime;if(a){var p=Date.now()-a;p>6e4&&u("flush_delay_received",l,{elapsed:p})}var d=l.timer;d&&(clearTimeout(d),l.timer=null)}else{l.opsSinceFlush+=1,i&&(l.whileReconnecting+=1);var h,v=null!==(h=l.startTime)&&void 0!==h?h:Date.now();l.startTime=v,l.timer||(l.timer=setTimeout(function(){u("flush_delay_timeout",l)},6e4)),150===l.opsSinceFlush?u("flush_delay_small",l):1e3===l.opsSinceFlush&&u("flush_delay_large",l)}}({filePath:r,replId:n,opType:t,logger:e.logger,isReconnecting:e.isReconnecting}),l.Z.set(d[t](n,r),o)}var w={};function b(e){return _.apply(this,arguments)}function _(){return(_=(0,i._)(function(e){var r,n,t,o,a,c,f,h;return(0,s.Jh)(this,function(v){var g;return r=e.filePath,n=e.replId,t=e.serverVersion,o=e.serverContent,a=e.fetchOps,c=e.logger,w[r+n]||(w[r+n]=!0,f=function(e,r){var n={latestOp:null,latestFlushedOp:null,latestOwnOp:null},t=Object.keys(n),o=!0,i=!1,u=void 0;try{for(var s,a=t[Symbol.iterator]();!(o=(s=a.next()).done);o=!0){var c=s.value,f=l.Z.get(d[c](e,r),"object");f&&f&&"object"==typeof f&&"number"==typeof f.crc32&&"number"==typeof f.version&&(n[c]=f)}}catch(e){i=!0,u=e}finally{try{o||null==a.return||a.return()}finally{if(i)throw u}}return n}(n,r),h=p.str(o)>>>0,Object.keys(f).forEach((g=(0,i._)(function(e){var r,n,o;return(0,s.Jh)(this,function(i){switch(i.label){case 0:if(!(r=f[e]))return[2];if(t<r.version)return c.info("ot client dataloss",{opType:e,case:"server_forgot"}),[2];if(t===r.version)return h!==r.crc32&&c.info("ot client dataloss",{opType:e,case:"crc32_mismatch"}),[2];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,a(r.version,r.version)];case 2:return n=u._.apply(void 0,[i.sent(),1])[0],[3,4];case 3:return o=i.sent(),c.info("ot client dataloss",{opType:e,case:"error_fetching_op",originalError:String(o)}),[2];case 4:if(!n)return c.info("ot client dataloss",{opType:e,case:"op_not_found"}),[2];return n.crc32!==r.crc32&&c.info("ot client dataloss",{opType:e,case:"crc32_mismatch"}),[2]}})}),function(e){return g.apply(this,arguments)}))),[2]})})).apply(this,arguments)}var R=n(48170);function C(e){var r=e.container,n=e.channelRequestPriority;return(0,R.Z)({container:r,dataloss:t,track:o.j,channelRequestPriority:n})}},44161:function(e,r,n){n.d(r,{Z:function(){return s}});var t=n(47611),o=n.n(t),i=n(66005),u=n(49500);function s(e){var r=e.throwBsod,n=e.tags,t=e.extras,s=e.origin,l=e.onNonBsodUnrecoverableError,a=void 0===l?function(){}:l;return function(e){var l=(0,i.ZP)(e);if(l===i.Gs.NotFound){o().push("/home","~/");return}if(l===i.Gs.LanguageTokenDenied){window.location.reload();return}if(l){a(l);return}u.error(e),r({error:e,tags:n,extras:t,origin:s})}}},63009:function(e,r,n){n.d(r,{I7:function(){return y},Id:function(){return g},ic:function(){return b},jT:function(){return v},qg:function(){return w},uV:function(){return m}});var t=n(41733),o=n(30509),i=n(1323),u=n(64461),s=n(19713),l=n(80703),a=n(65381),c=n(50959),f=(0,s.cn)(null),p=(0,s.cn)(null,function(e,r,n){var u=n.error,s=n.tags,l=n.extras,a=n.origin,c=(0,o._)((0,t._)({},s),{origin:a});"statusCode"in u?c.statusCode=u.statusCode:"status"in u&&(c.statusCode=u.status),e(f)||r(f,{eventId:(0,i.I)(u,{tags:c,extras:l}),error:u,sentry:{tags:c,extras:l},origin:a})}),d=(0,s.cn)(null,function(e,r){r(f,null)}),h=(0,s.cn)(new Map);function v(){return(0,a.lV)((0,c.useCallback)(function(e,r,n){var t=n.filePath;return e(h).get(t)},[]))}function g(){return(0,a.lV)((0,c.useCallback)(function(e,r,n){var t=n.filePath,o=n.version;r(h,function(e){return(0,u.Uy)(e,function(e){e.set(t,o)})})},[]))}function y(){return(0,a.lV)((0,c.useCallback)(function(e,r,n){var t=n.filePath;r(h,function(e){return(0,u.Uy)(e,function(e){e.delete(t)})})},[]))}function m(){return(0,l.b9)(p)}function w(){return[(0,l.Dv)(f),m()]}function b(){return(0,l.b9)(d)}},2148:function(e,r,n){n.d(r,{Z:function(){return g},l:function(){return v}});var t=n(27387),o=n(63257),i=n(96583),u=n(83493),s=n(59808),l=n(30084),a=n(39756),c=n(25202),f=n(30671),p=n(40247),d=n(91620).lW,h=n(34523),v=".replit";function g(e){var r,n,g,y,m=e.container,w=e.fs,b=e.channelRequestPriority,_=e.ctx,R=(0,u.ZP)();R.setMaxListeners(50);var C=null,E=null,F=null;function O(){return k.apply(this,arguments)}function k(){return(k=(0,t._)(function(){return(0,i.Jh)(this,function(e){return C&&"open"===C.status?[2,C]:[2,new Promise(function(e){R.once(s.zW.CHANNEL_OPENED,function(r){e(r)})})]})})).apply(this,arguments)}(function(){P.apply(this,arguments)})(),m.openChannel({service:"dotreplit",priority:b},function(e){var r=e.channel;return C=r,R.emit(s.zW.CHANNEL_OPENED,r),function(){C=null}});var I=!1;function P(){return(P=(0,t._)(function(){return(0,i.Jh)(this,function(e){return w.watchDir(a.Ql,{onChange:function(e){if(!e.some(function(e){return e.filename===v&&e.type===l.Tv.File})){(null==E?void 0:E.error)!==s.Yt.NotFound&&(E={error:s.Yt.NotFound,errorMessage:"",config:null},R.emit(s.zW.CHANGE,E));return}I||(I=!0,w.watchFile(v,{onChange:function(){E=null,Z.getConfig({bypassCache:!0}).then(function(e){R.emit(s.zW.CHANGE,e)})},onMoveOrDelete:function(){I=!1},onError:function(e,r){E=null,I=!1,e.code||m.unrecoverableError(e,r)}}))},onError:function(e,r){m.unrecoverableError(e,r)}}),[2]})})).apply(this,arguments)}function T(){return(T=(0,t._)(function(){return(0,i.Jh)(this,function(e){switch(e.label){case 0:return E=null,F||(F=function(){return N.apply(this,arguments)}()),[4,F];case 1:return E=e.sent(),F=null,[2,E]}})})).apply(this,arguments)}function N(){return(N=(0,t._)(function(){return(0,i.Jh)(this,function(e){var r;return[2,(0,f.DW)(_,"dotreplit.getConfigFromServer",(r=(0,t._)(function(e,r){var n,t,o,u;return(0,i.Jh)(this,function(i){switch(i.label){case 0:var l,a,c;return null==r||r.setAttributes((l={},(null==(a=m.getConnectionMetadata())?void 0:a.token)&&(l.tokenCluster=function(e){var r=e.split(".");if(4!==r.length)throw Error("Invalid token: should have exactly 4 parts: "+e);for(var n=r[2].replace(/-/g,"+").replace(/_/g,"/");n.length%4;)n+="=";var t=window.atob(n);if(t.length<64)throw Error("Invalid token: signed part is too short: "+t.length);var o=t.substring(0,t.length-64);return p.api.token.ReplToken.decode(d.from(o,"base64"))}(a.token).cluster),c=!!window.performance.getEntriesByName(h.Iy.pageNavStart,"mark").length,l.ssr=c,l)),[4,O()];case 1:if("closed"===(t=i.sent()).status)return[2,{error:s.Yt.Disconnected,errorMessage:"channel closed",config:null}];return[4,t.request({dotReplitGetRequest:{},traceInfo:e?(0,f.Rg)(e):void 0})];case 2:if((o=i.sent()).channelClosed)return[2,{error:s.Yt.Disconnected,errorMessage:"channel closed",config:null}];if(o.error){if(o.error.includes("unable to decode"))return[2,{error:s.Yt.ParseError,errorMessage:o.error,config:null}];if(o.error.includes("no such file"))return[2,{error:s.Yt.NotFound,errorMessage:o.error,config:null}];return[2,{error:s.Yt.Unknown,errorMessage:o.error,config:null}]}if(!(u=null===(n=o.dotReplitGetResponse)||void 0===n?void 0:n.dotReplit))return m.unrecoverableError(Error("Dotreplit responded with no error and no config")),[2,{error:s.Yt.Unknown,errorMessage:"Expected dotReplitGetResponse to include dotReplit",config:null}];return[2,{error:null,errorMessage:null,config:u}]}})}),function(e,n){return r.apply(this,arguments)}))]})})).apply(this,arguments)}var M=(r=(0,t._)(function(e){var r;return(0,i.Jh)(this,function(n){switch(n.label){case 0:return[4,w.stat(v)];case 1:if(n.sent().exists)return[3,3];return[4,w.writeFile(v,"")];case 2:n.sent(),n.label=3;case 3:return[4,O()];case 4:return[4,n.sent().request({dotReplitUpdateRequest:{ops:e}})];case 5:if((r=n.sent()).channelClosed)return[2,{errorMessage:"Channel closed.",error:s.au.ChannelClosed,response:null}];if(r.error){if(r.error.includes("could not parse json")||r.error.includes("is not json")||r.error.includes("parsing value field")||r.error.includes("missing field"))return[2,{errorMessage:r.error,error:s.au.JSONParseError,response:null}];if(r.error.includes("could not read file"))return[2,{errorMessage:r.error,error:s.au.NotFound,response:null}];if(r.error.includes("could not parse toml"))return[2,{errorMessage:r.error,error:s.au.TOMLParseError,response:null}];if(r.error.includes("unknown variant"))return[2,{errorMessage:r.error,error:s.au.OpType,response:null}];if(r.error.includes("could not write to file"))return[2,{errorMessage:r.error,error:s.au.CouldNotWrite,response:null}];if(r.error.includes("could not read line"))return[2,{errorMessage:r.error,error:s.au.ReadLine,response:null}];return[2,{errorMessage:r.error,error:s.au.Unknown,response:null}]}if(!r.dotReplitUpdateResponse)throw Error("Expected .replit to be updated");return[2,{response:r.dotReplitUpdateResponse,error:null,errorMessage:null}]}})}),function(e){return r.apply(this,arguments)}),Z={watch:function(e){var r=!1,n=!1,t=function(){for(var r=arguments.length,t=Array(r),i=0;i<r;i++)t[i]=arguments[i];n=!0,e.apply(void 0,(0,o._)(t))};return R.on(s.zW.CHANGE,t),Z.getConfig().then(function(e){r||n||t(e)}),function(){r=!0,R.removeListener(s.zW.CHANGE,t)}},getConfig:function(e){return(0,t._)(function(){return(0,i.Jh)(this,function(r){return(null==e?void 0:e.bypassCache)||!E?[2,function(){return T.apply(this,arguments)}()]:[2,E]})})()},getRunConfig:function(){return(0,t._)(function(){var e,r;return(0,i.Jh)(this,function(n){switch(n.label){case 0:return[4,O()];case 1:return[4,n.sent().request({runConfigGetRequest:{}})];case 2:if((e=n.sent()).channelClosed)return[2,this.getRunConfig()];if(!e.runConfigGetResponse)throw null!==(r=e.error)&&void 0!==r?r:Error("expected run config");return[2,e.runConfigGetResponse]}})}).apply(this)},updateDotReplit:(n=[],g=400,y=(0,c.Z)((0,t._)(function(){var e;return(0,i.Jh)(this,function(r){switch(r.label){case 0:return[4,M(n)];case 1:return e=r.sent(),n=[],[2,e]}})}),{wait:g}),function(e,r){r&&(g=r);var t=!0,o=!1,i=void 0;try{for(var u,s=e[Symbol.iterator]();!(t=(u=s.next()).done);t=!0)!function(){var e=u.value,r=n.findIndex(function(r){return r.path===e.path});-1!==r?n[r]=e:n.push(e)}()}catch(e){o=!0,i=e}finally{try{t||null==s.return||s.return()}finally{if(o)throw i}}return y()})};return Z}}}]);
//# sourceMappingURL=9802-81e910cbdad6ebea.js.map